import{_ as B,R as T,O as I,N as L,K as P,c as b,b as t,w as l,t as C,M as q,e as n,h as d,i as r,x as N,r as _,L as M,E as V,Q as O,o as p}from"./index-CV45lKxV.js";const j={components:{Document:P,Download:L,Refresh:I,Notebook:T},setup(){const c=_({courseContent:"",questionType:"multiple-choice",difficulty:"medium",count:5}),e=_(!1),u=_(0),o=_(""),i=_(""),v=_(""),x=M(()=>{var s;const a=(s=i.value.split(".").pop())==null?void 0:s.toLowerCase();return["pdf","txt","html"].includes(a||"")});return{form:c,loading:e,loadingProgress:u,fileUrl:o,fileName:i,error:v,isPreviewable:x,generateExam:async()=>{if(!c.value.courseContent){V.warning("请输入课程内容");return}e.value=!0,u.value=0,o.value="",i.value="",v.value="";const a=setInterval(()=>{u.value<90&&(u.value+=10)},1e3);try{const s=await O.post("/api/static/exam",{content:c.value.courseContent,type:c.value.questionType,count:c.value.count,paper:"试卷1"},{responseType:"blob"}),f=s.headers["content-disposition"];if(f){const g=f.match(/filename="?([^"]*)"?/);g&&g[1]?i.value=g[1]:i.value="习题文件.pdf"}else i.value="习题文件.pdf";const y=new Blob([s.data],{type:s.headers["content-type"]||"application/octet-stream"});o.value=URL.createObjectURL(y),u.value=100,V.success("习题生成成功")}catch(s){console.error("生成习题失败:",s),v.value="生成习题失败，请重试",u.value=0}finally{clearInterval(a),e.value=!1}},downloadFile:()=>{if(!o.value)return;const a=document.createElement("a");a.href=o.value,a.download=i.value,document.body.appendChild(a),a.click(),document.body.removeChild(a)},resetForm:()=>{c.value={courseContent:"",questionType:"multiple-choice",difficulty:"medium",count:5},o.value="",i.value="",v.value=""}}}},G={class:"exercise-generator"},K={class:"card-header"},Q={key:0,class:"loading-container"},S={key:1,class:"file-container"},z={class:"file-header"},A={class:"file-name"},H={class:"file-preview"},J=["src"],W={key:1,class:"no-preview"},X={class:"file-actions"};function Y(c,e,u,o,i,v){const x=n("Notebook"),m=n("el-icon"),h=n("el-input"),w=n("el-form-item"),a=n("el-radio"),s=n("el-radio-group"),f=n("Document"),y=n("el-button"),g=n("el-form"),D=n("el-progress"),E=n("Download"),U=n("Refresh"),F=n("el-alert"),R=n("el-card");return p(),b("div",G,[t(R,{class:"exercise-card"},{header:l(()=>[r("div",K,[r("h2",null,[t(m,null,{default:l(()=>[t(x)]),_:1}),e[3]||(e[3]=d(" 习题生成器"))])])]),default:l(()=>[t(g,{model:o.form,class:"exercise-form"},{default:l(()=>[t(w,{label:"课程内容"},{default:l(()=>[t(h,{modelValue:o.form.courseContent,"onUpdate:modelValue":e[0]||(e[0]=k=>o.form.courseContent=k),type:"textarea",rows:4,placeholder:"请输入课程内容"},null,8,["modelValue"])]),_:1}),t(w,{label:"难度"},{default:l(()=>[t(s,{modelValue:o.form.difficulty,"onUpdate:modelValue":e[1]||(e[1]=k=>o.form.difficulty=k)},{default:l(()=>[t(a,{label:"easy"},{default:l(()=>e[4]||(e[4]=[d("简单")])),_:1}),t(a,{label:"medium"},{default:l(()=>e[5]||(e[5]=[d("中等")])),_:1}),t(a,{label:"hard"},{default:l(()=>e[6]||(e[6]=[d("困难")])),_:1})]),_:1},8,["modelValue"])]),_:1}),t(w,null,{default:l(()=>[t(y,{type:"primary",onClick:o.generateExam,loading:o.loading,class:"generate-btn"},{default:l(()=>[t(m,null,{default:l(()=>[t(f)]),_:1}),e[7]||(e[7]=d(" 生成习题 "))]),_:1},8,["onClick","loading"])]),_:1})]),_:1},8,["model"]),o.loading?(p(),b("div",Q,[t(D,{type:"circle",percentage:o.loadingProgress,"stroke-width":8,width:120,status:"success"},null,8,["percentage"]),e[8]||(e[8]=r("p",{class:"loading-text"},"正在生成习题，请稍候...",-1))])):C("",!0),o.fileUrl?(p(),b("div",S,[r("div",z,[r("h2",null,[t(m,null,{default:l(()=>[t(f)]),_:1}),e[9]||(e[9]=d(" 生成的习题文件"))]),r("span",A,N(o.fileName),1)]),r("div",H,[o.isPreviewable?(p(),b("iframe",{key:0,src:o.fileUrl,width:"100%",height:"500px"},null,8,J)):(p(),b("div",W,[t(m,null,{default:l(()=>[t(f)]),_:1}),r("p",null,N(o.fileName),1),e[10]||(e[10]=r("span",{class:"preview-hint"},"此文件类型无法预览",-1))]))]),r("div",X,[t(y,{type:"primary",onClick:o.downloadFile,class:"action-btn"},{default:l(()=>[t(m,null,{default:l(()=>[t(E)]),_:1}),e[11]||(e[11]=d(" 下载习题 "))]),_:1},8,["onClick"]),t(y,{onClick:o.resetForm,class:"action-btn"},{default:l(()=>[t(m,null,{default:l(()=>[t(U)]),_:1}),e[12]||(e[12]=d(" 重新生成 "))]),_:1},8,["onClick"])])])):C("",!0),o.error?(p(),q(F,{key:2,title:o.error,type:"error","show-icon":"",closable:!0,onClose:e[2]||(e[2]=k=>o.error=""),class:"error-alert"},null,8,["title"])):C("",!0)]),_:1})])}const $=B(j,[["render",Y],["__scopeId","data-v-4e140af5"]]);export{$ as default};
