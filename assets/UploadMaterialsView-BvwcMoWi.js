import{d as H,r as v,a as M,c as x,b as t,w as l,e as o,i as n,t as I,h as p,f as U,K,V as Q,E as r,Q as R,j as $,o as y,_ as q}from"./index-CV45lKxV.js";const D={class:"upload-materials-container"},F={class:"upload-content"},G={class:"action-buttons"},J={key:0,class:"upload-status"},O={key:1,class:"action-buttons"},W=H({__name:"UploadMaterialsView",emits:["step-completed"],setup(X,{emit:C}){const T=$(),c=C,b=v("file"),s=v(null),i=v(!1),d=M({title:"",content:""}),g=M({Authorization:`Bearer ${localStorage.getItem("token")}`}),B=a=>["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","text/plain"].includes(a.type)?a.size/1024/1024<20?(s.value={message:"正在上传文件，请稍候...",type:"info"},!0):(r.error("文件大小不能超过 20MB!"),!1):(r.error("请上传 .doc, .docx, .pdf 或 .txt 格式的文件!"),!1),S=(a,e)=>{r.success("材料上传成功！"),s.value={message:"材料上传成功！您可以继续生成大纲。",type:"success"},i.value=!0,c("step-completed","upload"),a&&a.materialId&&localStorage.setItem("currentMaterialId",a.materialId)},E=a=>{console.error("上传失败:",a),r.error("上传失败，请稍后重试"),s.value={message:"上传失败，请稍后重试。",type:"error"}},N=()=>{r.warning("一次只能上传一个文件")},h=async()=>{if(!d.title.trim()||!d.content.trim()){r.warning("请填写教学主题和内容");return}s.value={message:"正在提交内容，请稍候...",type:"info"};try{const a=await R.post("/api/workflow/submit-text",d,{headers:g});r.success("内容提交成功！"),s.value={message:"内容提交成功！您可以继续生成大纲。",type:"success"},i.value=!0,c("step-completed","upload"),a&&a.data&&a.data.materialId&&localStorage.setItem("currentMaterialId",a.data.materialId)}catch(a){console.error("提交失败:",a),r.error("提交失败，请稍后重试"),s.value={message:"提交失败，请稍后重试。",type:"error"}}},w=()=>{i.value=!0,c("step-completed","upload"),T.push("/workflow/generate-outline")};return(a,e)=>{const m=o("el-icon"),_=o("el-button"),z=o("el-upload"),V=o("el-tab-pane"),k=o("el-input"),f=o("el-form-item"),L=o("el-form"),P=o("el-tabs"),j=o("el-alert"),A=o("el-card");return y(),x("div",D,[t(A,{class:"upload-card"},{header:l(()=>e[3]||(e[3]=[n("div",{class:"card-header"},[n("h2",null,"上传教学材料")],-1)])),default:l(()=>[n("div",F,[e[9]||(e[9]=n("p",{class:"upload-description"}," 上传您的教学材料或直接输入文字内容，系统将根据您提供的材料生成教学大纲和PPT。 支持上传 .doc, .docx, .pdf, .txt 格式文件。 ",-1)),n("div",G,[t(_,{type:"primary",onClick:w,size:"large"},{default:l(()=>[t(m,null,{default:l(()=>[t(U(K))]),_:1}),e[4]||(e[4]=p(" 直接生成大纲 "))]),_:1})]),t(P,{modelValue:b.value,"onUpdate:modelValue":e[2]||(e[2]=u=>b.value=u),class:"material-tabs"},{default:l(()=>[t(V,{label:"上传文件",name:"file"},{default:l(()=>[t(z,{class:"upload-area",drag:"",action:"/api/workflow/upload-materials","on-success":S,"on-error":E,"before-upload":B,headers:g,limit:1,"on-exceed":N},{tip:l(()=>e[5]||(e[5]=[n("div",{class:"el-upload__tip"}," 请上传 .doc, .docx, .pdf 或 .txt 格式文件，文件大小不超过 20MB ",-1)])),default:l(()=>[t(m,{class:"el-icon--upload"},{default:l(()=>[t(U(Q))]),_:1}),e[6]||(e[6]=n("div",{class:"el-upload__text"},[p(" 拖拽文件到此处或 "),n("em",null,"点击上传")],-1))]),_:1},8,["headers"])]),_:1}),t(V,{label:"输入文字",name:"text"},{default:l(()=>[t(L,null,{default:l(()=>[t(f,{label:"教学主题"},{default:l(()=>[t(k,{modelValue:d.title,"onUpdate:modelValue":e[0]||(e[0]=u=>d.title=u),placeholder:"请输入教学主题"},null,8,["modelValue"])]),_:1}),t(f,{label:"教学内容"},{default:l(()=>[t(k,{modelValue:d.content,"onUpdate:modelValue":e[1]||(e[1]=u=>d.content=u),type:"textarea",rows:10,placeholder:"请输入教学内容"},null,8,["modelValue"])]),_:1}),t(f,null,{default:l(()=>[t(_,{type:"primary",onClick:h},{default:l(()=>e[7]||(e[7]=[p("提交内容")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),s.value?(y(),x("div",J,[t(j,{title:s.value.message,type:s.value.type,closable:!1,"show-icon":""},null,8,["title","type"])])):I("",!0),i.value?(y(),x("div",O,[t(_,{type:"primary",onClick:w},{default:l(()=>e[8]||(e[8]=[p("继续生成大纲")])),_:1})])):I("",!0)])]),_:1})])}}}),Z=q(W,[["__scopeId","data-v-51984318"]]);export{Z as default};
